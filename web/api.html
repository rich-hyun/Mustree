<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API 설명서 · 머스트리 네트워크</title>
  <meta name="description" content="국민은행 과제: RWARights 스마트 컨트랙트를 REST API로 제공하는 문서" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body class="home">
  <!-- ✅ 헤더 래퍼 정상화 -->
  <header class="app-header">
    <div class="app-header-inner">
      <!-- ↓↓↓ 이 블록은 요청대로 절대 수정하지 않음 ↓↓↓ -->
      <div class="hdr-left">
        <h1>머스트리 네트워크</h1>
        <nav class="menu">
          <a href="./index.html">홈</a>
          <a href="./network.html">네트워크 생성 서비스</a>
          <a href="./api.html" class="active">API 제공 서비스</a>
          <a href="./api-guide.html">API 사용 설명 서비스</a>
          <a href="./bridge.html">브릿지 (준비중)</a>
          <a href="./sbt.html">SBT (준비중)</a>
          <a href="./rwa.html">RWA (준비중)</a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <!-- ===== Hero ===== -->
    <section class="hero hero-visual">
      <div class="hero-bg" aria-hidden="true"></div>
      <div class="container hero-inner">
        <p class="eyebrow">KB RWA API</p>
        <h1>RWARights 컨트랙트를 REST API로 그대로</h1>
        <p class="sub">
          <code>자체 스마트 컨트랙트</code> 를 기반으로
          <strong>매니저 설정</strong>·<strong>담보 생성</strong>·<strong>지분/열람권 표기</strong>·<strong>열람권 소각</strong>을 HTTP API로 제공합니다.
        </p>
        <div class="badges">
          <span class="badge">OpenAPI 3.1</span>
          <span class="badge">Auth: <code>x-api-key</code></span>
          <span class="badge">Network: 전용 PoA</span>
        </div>
      </div>
    </section>

    <!-- ===== KB 과제 개요 ===== -->
    <section class="section">
      <div class="container grid cols-2">
        <article class="card">
          <h3>국민은행 과제 — 제공 범위</h3>
          <ul>
            <li><strong>매니저(머스트리) API</strong> — <code>setManager</code> : 전권자 설정</li>
            <li><strong>대출 담보 생성 API</strong> — <code>createAsset</code> : 타이틀·뷰어 동시 발행</li>
            <li><strong>지분/열람권 표기 API</strong> — <code>tokenURI</code> : 메타데이터/권리 표기</li>
            <li><strong>열람권만 소각 API</strong> — <code>burnViewer</code> : Viewer 토큰 소각</li>
            <li>그 외 표준 ERC‑721/조회/이벤트 API를 모두 제공</li>
          </ul>
          <p class="small">※ 민감 정보(docHash)는 이벤트로 노출하지 않으며, 권한 보유자만 조회 가능.</p>
        </article>
        <article class="card">
          <h3>호출 정보</h3>
          <ul>
            <li>Base URL: <code id="baseUrlHint">http://localhost:8080/api/v1</code></li>
            <li>인증: 요청 헤더 <code>x-api-key: &lt;YOUR_API_KEY&gt;</code></li>
            <li>네트워크: 사내 EVM (RPC/CHAIN_ID는 서버 <code>.env</code> 설정)</li>
          </ul>
          <div class="notice">서버 게이트웨이 예시는 <code>server.js</code> 기준입니다. (ethers v5)</div>
        </article>
      </div>
    </section>

    <!-- ===== 핵심 API (4가지) ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">핵심 API (KB 과제 납품 항목)</h2>

        <div class="grid cols-2">
          <!-- setManager -->
          <article class="card">
            <h3>1) 매니저 설정 API — <code>setManager</code></h3>
            <p class="small">컨트랙트 소유자만 호출 가능. 매니저는 <code>createAsset</code> 등 운영 권한을 가집니다.</p>
<pre class="mono small">
POST /contract/set-manager
Headers: x-api-key
Body:
{
  "manager": "0xManager..."
}
Response: { "transactionHash": "...", "blockNumber": 123, "gasUsed": "..." }
</pre>
            <div class="cta-row">
              <button class="btn" onclick="apiSetManager()">Try: setManager</button>
              <button class="btn ghost" onclick="copyCurl('setManager')">cURL 복사</button>
            </div>
          </article>

          <!-- createAsset -->
          <article class="card">
            <h3>2) 대출 담보 생성 API — <code>createAsset</code></h3>
            <p class="small">타이틀(은행 보유)·뷰어(감정인 보유)를 동시에 발행합니다. <code>AssetCreated</code> 이벤트 발생.</p>
<pre class="mono small">
POST /assets
Headers: x-api-key
Body:
{
  "assetId": "1",
  "viewerId": "1001",
  "bank": "0xBank...",
  "appraiser": "0xAppraiser...",
  "borrower": "0xBorrower...",
  "docHash": "ipfs://bafy.../report.pdf"
}
</pre>
            <div class="cta-row">
              <button class="btn" onclick="apiCreateAsset()">Try: createAsset</button>
              <button class="btn ghost" onclick="copyCurl('createAsset')">cURL 복사</button>
            </div>
          </article>

          <!-- tokenURI -->
          <article class="card">
            <h3>3) 지분/열람권 표기 API — <code>tokenURI</code></h3>
            <p class="small">메타데이터(JSON Base64)를 반환합니다. Viewer/Title 여부, Ownership %, Asset/Token ID를 포함.</p>
<pre class="mono small">
GET /tokens/{tokenId}/uri
Response:
{ "tokenId": "1001", "tokenURI": "data:application/json;base64,eyJ..." }
</pre>
            <div class="cta-row">
              <input id="decodeTokenId" class="kbd" placeholder="tokenId (예: 1)" style="width:160px">
              <button class="btn" onclick="apiGetTokenURI()">Try &amp; Decode</button>
              <button class="btn ghost" onclick="copyCurl('tokenURI')">cURL 복사</button>
            </div>
            <pre id="decodeOut" class="mono small" style="margin-top:8px"></pre>
          </article>

          <!-- burnViewer -->
          <article class="card">
            <h3>4) 열람권만 소각 API — <code>burnViewer</code></h3>
            <p class="small">권한: 매니저 또는 타이틀(은행) 보유자. <code>ViewerBurned</code> 이벤트 발생.</p>
<pre class="mono small">
POST /assets/{assetId}/viewer/burn
Headers: x-api-key
</pre>
            <div class="cta-row">
              <input id="burnAssetId" class="kbd" placeholder="assetId (예: 1)" style="width:160px">
              <button class="btn" onclick="apiBurnViewer()">Try: burnViewer</button>
              <button class="btn ghost" onclick="copyCurl('burnViewer')">cURL 복사</button>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- ===== 전체 조회 API ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">조회 API 전체 목록</h2>
        <table class="table" aria-label="조회 API">
          <thead>
            <tr><th>함수</th><th>HTTP</th><th>설명</th></tr>
          </thead>
          <tbody>
            <tr><td><code>assetOfViewer(viewerId)</code></td><td>GET <span class="kbd">/viewers/{viewerId}/asset</span></td><td>Viewer 토큰 → Asset ID 매핑</td></tr>
            <tr><td><code>balanceOf(owner)</code></td><td>GET <span class="kbd">/accounts/{owner}/balance</span></td><td>주소가 보유한 NFT 개수</td></tr>
            <tr><td><code>debugAsset(assetId)</code></td><td>GET <span class="kbd">/assets/{assetId}</span></td><td>은행/감정인/차주/ViewerId/exists</td></tr>
            <tr><td><code>exists(tokenId)</code></td><td>GET <span class="kbd">/tokens/{tokenId}/exists</span></td><td>토큰 발행 여부</td></tr>
            <tr><td><code>getApproved(tokenId)</code></td><td>GET <span class="kbd">/approvals/{tokenId}</span></td><td>개별 승인 주소</td></tr>
            <tr><td><code>getViewerTokenId(assetId)</code></td><td>GET <span class="kbd">/assets/{assetId}/viewer-token-id</span></td><td>자산의 Viewer 토큰 ID</td></tr>
            <tr><td><code>isApprovedForAll(owner,operator)</code></td><td>GET <span class="kbd">/approvals/is-approved-for-all?owner=&amp;operator=</span></td><td>전체 승인 여부</td></tr>
            <tr><td><code>isViewer(tokenId)</code></td><td>GET <span class="kbd">/tokens/{tokenId}/is-viewer</span></td><td>Viewer/Title 구분</td></tr>
            <tr><td><code>manager()</code></td><td>GET <span class="kbd">/contract/manager</span></td><td>현재 매니저 주소</td></tr>
            <tr><td><code>name()</code></td><td>GET <span class="kbd">/contract/name</span></td><td>컬렉션 이름</td></tr>
            <tr><td><code>owner()</code></td><td>GET <span class="kbd">/contract/owner</span></td><td>컨트랙트 소유자</td></tr>
            <tr><td><code>ownerOf(tokenId)</code></td><td>GET <span class="kbd">/tokens/{tokenId}/owner</span></td><td>토큰 소유자</td></tr>
            <tr><td><code>supportsInterface(interfaceId)</code></td><td>GET <span class="kbd">/contract/supports-interface/{interfaceId}</span></td><td>인터페이스 지원 여부</td></tr>
            <tr><td><code>symbol()</code></td><td>GET <span class="kbd">/contract/symbol</span></td><td>토큰 심볼</td></tr>
            <tr><td><code>tokenURI(tokenId)</code></td><td>GET <span class="kbd">/tokens/{tokenId}/uri</span></td><td>메타데이터(JSON Base64)</td></tr>
            <tr><td><code>viewDocHash(assetId)</code></td><td>GET <span class="kbd">/assets/{assetId}/doc-hash</span></td><td>(권한 필요) 문서 해시</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ===== 이벤트 API ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">이벤트 API</h2>
        <div class="grid cols-2">
          <article class="card">
            <h3>자산 생성</h3>
            <p class="small"><code>AssetCreated(assetId, viewerTokenId, bank, appraiser, borrower)</code></p>
<pre class="mono small">GET /events/asset-created?assetId=&viewerTokenId=&bank=&fromBlock=0&toBlock=latest</pre>
          </article>
          <article class="card">
            <h3>열람 기록</h3>
            <p class="small"><code>Viewed(assetId, by)</code></p>
<pre class="mono small">GET /events/viewed?assetId=&by=&fromBlock=0&toBlock=latest</pre>
          </article>
          <article class="card">
            <h3>뷰어 소각</h3>
            <p class="small"><code>ViewerBurned(assetId, viewerTokenId, by)</code></p>
<pre class="mono small">GET /events/viewer-burned?assetId=&viewerTokenId=&by=</pre>
          </article>
          <article class="card">
            <h3>표준 이벤트</h3>
            <p class="small"><code>Transfer/Approval/ApprovalForAll/OwnershipTransferred/ManagerSet</code></p>
<pre class="mono small">GET /events/transfer?from=&to=&tokenId=
GET /events/approval?owner=&approved=&tokenId=
GET /events/approval-for-all?owner=&operator=
GET /events/ownership-transferred?previousOwner=&newOwner=
GET /events/manager-set?manager=
</pre>
          </article>
        </div>
      </div>
    </section>

    <!-- ===== Try it ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">브라우저에서 바로 호출 (Try it)</h2>
        <div class="card">
          <div class="form" style="grid-template-columns: 5fr 3fr auto;">
            <input id="baseUrl" type="text" placeholder="Base URL (예: http://localhost:8080/api/v1)" />
            <input id="apiKey" type="text" placeholder="x-api-key" />
            <button class="btn" onclick="ping()">GET /health</button>
          </div>

          <div class="grid cols-2" style="margin-top:12px">
            <div class="field">
              <label>setManager</label>
              <input id="inManager" type="text" placeholder="0xManager..." />
              <button class="btn" onclick="apiSetManager()">호출</button>
            </div>

            <div class="field">
              <label>createAsset</label>
              <textarea id="inCreateAsset" placeholder='{"assetId":"1","viewerId":"1001","bank":"0x...","appraiser":"0x...","borrower":"0x...","docHash":"ipfs://..."}'></textarea>
              <button class="btn" onclick="apiCreateAsset()">호출</button>
            </div>

            <div class="field">
              <label>tokenURI</label>
              <input id="inTokenId" type="number" placeholder="tokenId" />
              <button class="btn" onclick="apiGetTokenURI()">호출</button>
            </div>

            <div class="field">
              <label>burnViewer</label>
              <input id="inBurnAssetId" type="number" placeholder="assetId" />
              <button class="btn" onclick="apiBurnViewer()">호출</button>
            </div>
          </div>

          <pre id="out" class="mono small" style="margin-top:12px;min-height:160px">결과가 여기에 표시됩니다.</pre>
        </div>
      </div>
    </section>
    
    <!-- ===== 개요 ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">개요</h2>
        <div class="notice info">
          <strong>[핵심 개념]</strong><br/>
          “<em>스마트 컨트랙트를 API 형식으로 제공</em>”한다는 건,
          기술적으로는 <strong>블록체인 상의 트랜잭션 함수(ABI)</strong>들을
          <strong>HTTP 기반 REST API 또는 SDK</strong>로 감싸서
          <u>파트너사가 직접 블록체인 RPC를 다루지 않아도</u> 사용할 수 있게 하는 구조입니다.
        </div>
        <div class="grid cols-3" style="margin-top:14px">
          <article class="card">
            <h3>무지갑 통합</h3>
            <p class="small">고객사는 지갑/서명/가스 관리를 직접 하지 않고, <code>x-api-key</code>만으로 호출합니다.</p>
          </article>
          <article class="card">
            <h3>권한·감사</h3>
            <p class="small">민감 정보(docHash)는 이벤트로 노출하지 않으며, 권한자만 조회. 모든 변경은 이벤트로 감사 추적.</p>
          </article>
          <article class="card">
            <h3>표준화</h3>
            <p class="small">REST 규칙/오류 규칙/버전 관리로 엔터프라이즈 표준을 준수합니다.</p>
          </article>
        </div>
      </div>
    </section>

    <!-- ===== Quick Start ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">빠른 시작 (Quick Start)</h2>
        <div class="grid cols-2">
          <article class="card">
            <h3>1) 필수 정보</h3>
            <ul class="small">
              <li>Base URL: <code id="baseUrlHint">http://localhost:8080/api/v1</code></li>
              <li>인증: 헤더 <code>x-api-key: &lt;YOUR_API_KEY&gt;</code></li>
              <li>컨트랙트: <code>0x0178d0837e584a2a78b086695dd513b9ebc94a4e</code></li>
              <li>네트워크: 사내 EVM (RPC/CHAIN_ID는 서버 <code>.env</code>에 설정)</li>
            </ul>
            <div class="note">운영/샌드박스의 Base URL은 다를 수 있습니다. 내부 포털에서 확인하세요.</div>
          </article>

          <article class="card">
            <h3>2) 첫 호출 (health)</h3>
            <div class="code-tabs">
              <div class="tab-buttons">
                <button class="tab-btn active" data-tab="curl1">cURL</button>
                <button class="tab-btn" data-tab="js1">JavaScript</button>
                <button class="tab-btn" data-tab="py1">Python</button>
              </div>
              <div class="tab-panel active" id="curl1">
<pre><code class="mono small">curl -H "x-api-key: $API_KEY" \
  "http://localhost:8080/api/v1/health"</code></pre>
              </div>
              <div class="tab-panel" id="js1">
<pre><code class="mono small">fetch("http://localhost:8080/api/v1/health", {
  headers: { "x-api-key": API_KEY }
}).then(r =&gt; r.json()).then(console.log)</code></pre>
              </div>
              <div class="tab-panel" id="py1">
<pre><code class="mono small">import requests
r = requests.get("http://localhost:8080/api/v1/health",
                 headers={"x-api-key": API_KEY})
print(r.json())</code></pre>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- ===== 핵심 플로우(Manager → Asset → Viewer) ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">KB 과제 핵심 플로우</h2>
        <ol class="small">
          <li><strong>매니저 설정</strong> – <code>setManager</code> 로 운영 계정 권한 위임</li>
          <li><strong>담보 생성</strong> – <code>createAsset</code> 으로 Title/Viewer 동시 발행</li>
          <li><strong>메타데이터 확인</strong> – <code>tokenURI</code> 로 Viewer/Title 여부, Ownership % 확인</li>
          <li><strong>열람</strong> – <code>recordAppraiserView</code> 또는 <code>viewDocHash</code> (권한 필요)</li>
          <li><strong>열람권 회수</strong> – <code>burnViewer</code> 로 Viewer 소각</li>
        </ol>

        <!-- setManager -->
        <article class="card" style="margin-top:12px">
          <h3>1) 매니저 설정 — <code>setManager</code></h3>
          <p class="small">컨트랙트 소유자만 호출 가능. 매니저는 자산 생성/관리 권한을 가집니다.</p>
          <div class="code-tabs">
            <div class="tab-buttons">
              <button class="tab-btn active" data-tab="curl-mgr">cURL</button>
              <button class="tab-btn" data-tab="js-mgr">JavaScript</button>
              <button class="tab-btn" data-tab="py-mgr">Python</button>
            </div>
            <div class="tab-panel active" id="curl-mgr">
<pre><code class="mono small">curl -X POST "$BASE/contract/set-manager" \
  -H "x-api-key: $API_KEY" -H "content-type: application/json" \
  -d '{"manager":"0xManager..."}'</code></pre>
            </div>
            <div class="tab-panel" id="js-mgr">
<pre><code class="mono small">await fetch(`${BASE}/contract/set-manager`, {
  method: 'POST',
  headers: { 'x-api-key': API_KEY, 'content-type':'application/json' },
  body: JSON.stringify({ manager: "0xManager..." })
}).then(r =&gt; r.json())</code></pre>
            </div>
            <div class="tab-panel" id="py-mgr">
<pre><code class="mono small">import requests, json
r = requests.post(f"{BASE}/contract/set-manager",
  headers={'x-api-key': API_KEY, 'content-type':'application/json'},
  data=json.dumps({'manager':'0xManager...'}))
print(r.json())</code></pre>
            </div>
          </div>
          <table class="table small" style="margin-top:10px">
            <thead><tr><th>파라미터</th><th>타입</th><th>필수</th><th>설명</th></tr></thead>
            <tbody>
              <tr><td>manager</td><td>address</td><td>✅</td><td>새 매니저 지갑 주소</td></tr>
            </tbody>
          </table>
        </article>

        <!-- createAsset -->
        <article class="card" style="margin-top:12px">
          <h3>2) 담보 생성 — <code>createAsset</code></h3>
          <p class="small">Title(은행 소유)·Viewer(감정사 소유) 토큰을 동시에 민팅합니다.</p>
          <div class="code-tabs">
            <div class="tab-buttons">
              <button class="tab-btn active" data-tab="curl-asset">cURL</button>
              <button class="tab-btn" data-tab="js-asset">JavaScript</button>
              <button class="tab-btn" data-tab="py-asset">Python</button>
            </div>
            <div class="tab-panel active" id="curl-asset">
<pre><code class="mono small">curl -X POST "$BASE/assets" \
  -H "x-api-key: $API_KEY" -H "content-type: application/json" \
  -d '{
    "assetId":"1","viewerId":"1001",
    "bank":"0xBank...","appraiser":"0xAppraiser...",
    "borrower":"0xBorrower...","docHash":"ipfs://bafy.../report.pdf"
  }'</code></pre>
            </div>
            <div class="tab-panel" id="js-asset">
<pre><code class="mono small">await fetch(`${BASE}/assets`, {
  method:'POST',
  headers:{ 'x-api-key': API_KEY, 'content-type':'application/json' },
  body: JSON.stringify({
    assetId:"1", viewerId:"1001",
    bank:"0xBank...", appraiser:"0xAppraiser...",
    borrower:"0xBorrower...", docHash:"ipfs://bafy.../report.pdf"
  })
}).then(r =&gt; r.json())</code></pre>
            </div>
            <div class="tab-panel" id="py-asset">
<pre><code class="mono small">payload = {
  "assetId":"1","viewerId":"1001",
  "bank":"0xBank...","appraiser":"0xAppraiser...",
  "borrower":"0xBorrower...","docHash":"ipfs://bafy.../report.pdf"
}
r = requests.post(f"{BASE}/assets",
  headers={'x-api-key':API_KEY,'content-type':'application/json'},
  data=json.dumps(payload))
print(r.json())</code></pre>
            </div>
          </div>
          <table class="table small" style="margin-top:10px">
            <thead><tr><th>파라미터</th><th>타입</th><th>필수</th><th>설명</th></tr></thead>
            <tbody>
              <tr><td>assetId</td><td>uint256</td><td>✅</td><td>자산 토큰 ID(Title)</td></tr>
              <tr><td>viewerId</td><td>uint256</td><td>✅</td><td>열람권 토큰 ID(Viewer)</td></tr>
              <tr><td>bank</td><td>address</td><td>✅</td><td>은행(Title 수취인)</td></tr>
              <tr><td>appraiser</td><td>address</td><td>✅</td><td>감정사(Viewer 수취인)</td></tr>
              <tr><td>borrower</td><td>address</td><td>✅</td><td>차주</td></tr>
              <tr><td>docHash</td><td>string</td><td>✅</td><td>문서 해시(IPFS 등)</td></tr>
            </tbody>
          </table>
        </article>

        <!-- tokenURI -->
        <article class="card" style="margin-top:12px">
          <h3>3) 메타데이터 — <code>tokenURI</code></h3>
          <div class="code-tabs">
            <div class="tab-buttons">
              <button class="tab-btn active" data-tab="curl-uri">cURL</button>
              <button class="tab-btn" data-tab="js-uri">JavaScript</button>
              <button class="tab-btn" data-tab="py-uri">Python</button>
            </div>
            <div class="tab-panel active" id="curl-uri">
<pre><code class="mono small">curl -H "x-api-key: $API_KEY" "$BASE/tokens/1001/uri"</code></pre>
            </div>
            <div class="tab-panel" id="js-uri">
<pre><code class="mono small">const r = await fetch(`${BASE}/tokens/1001/uri`,
  { headers:{'x-api-key':API_KEY} }).then(r=&gt;r.json())
const dataUri = r.tokenURI; /* data:application/json;base64,... */
</code></pre>
            </div>
            <div class="tab-panel" id="py-uri">
<pre><code class="mono small">r = requests.get(f"{BASE}/tokens/1001/uri",
  headers={'x-api-key':API_KEY})
print(r.json())</code></pre>
            </div>
          </div>
          <div class="tip small">반환값은 <code>data:application/json;base64,...</code> 형식입니다.
            Base64 디코드하여 Viewer/Title 여부, Ownership %, Asset/Token ID를 확인하세요.</div>
        </article>

        <!-- recordAppraiserView & viewDocHash -->
        <article class="card" style="margin-top:12px">
          <h3>4) 열람/해시 — <code>recordAppraiserView</code>, <code>viewDocHash</code></h3>
          <div class="grid cols-2">
            <div>
              <h4 class="small">열람 기록 (쓰기)</h4>
<pre><code class="mono small">curl -X POST -H "x-api-key: $API_KEY" \
  "$BASE/assets/1/appraiser-view"</code></pre>
            </div>
            <div>
              <h4 class="small">문서 해시 (읽기, 권한 필요)</h4>
<pre><code class="mono small">curl -H "x-api-key: $API_KEY" \
  "$BASE/assets/1/doc-hash"</code></pre>
            </div>
          </div>
          <div class="note warn">권한: Title 보유 은행 또는 Viewer 보유자만 성공합니다.</div>
        </article>

        <!-- burnViewer -->
        <article class="card" style="margin-top:12px">
          <h3>5) 열람권 소각 — <code>burnViewer</code></h3>
<pre><code class="mono small">curl -X POST -H "x-api-key: $API_KEY" \
  "$BASE/assets/1/viewer/burn"</code></pre>
          <div class="note warn">권한: 매니저 또는 해당 자산의 Title 보유자</div>
        </article>
      </div>
    </section>

    <!-- ===== 브라우저 Try it ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">브라우저에서 바로 호출 (Try it)</h2>
        <div class="card">
          <div class="form" style="grid-template-columns: 5fr 3fr auto;">
            <input id="BASE" type="text" placeholder="Base URL (예: http://localhost:8080/api/v1)" />
            <input id="APIKEY" type="text" placeholder="x-api-key" />
            <button class="btn" onclick="ping()">GET /health</button>
          </div>
          <div class="grid cols-2" style="margin-top:12px">
            <div class="field">
              <label>setManager</label>
              <input id="inManager" type="text" placeholder="0xManager..." />
              <button class="btn" onclick="callSetManager()">호출</button>
            </div>
            <div class="field">
              <label>createAsset</label>
              <textarea id="inCreateAsset" placeholder='{"assetId":"1","viewerId":"1001","bank":"0x...","appraiser":"0x...","borrower":"0x...","docHash":"ipfs://..."}'></textarea>
              <button class="btn" onclick="callCreateAsset()">호출</button>
            </div>
            <div class="field">
              <label>tokenURI</label>
              <input id="inTokenId" type="number" placeholder="tokenId (예: 1001)" />
              <button class="btn" onclick="callTokenURI()">호출</button>
            </div>
            <div class="field">
              <label>burnViewer</label>
              <input id="inAssetId" type="number" placeholder="assetId (예: 1)" />
              <button class="btn" onclick="callBurnViewer()">호출</button>
            </div>
          </div>
          <pre id="out" class="mono small" style="margin-top:12px;min-height:160px">결과가 여기에 표시됩니다.</pre>
        </div>
      </div>
    </section>
    
    <!-- ===== 오류/보안 ===== -->
    <section class="section">
      <div class="container grid cols-2">
        <article class="card">
          <h3>오류 및 응답 규칙</h3>
          <table class="table small">
            <thead><tr><th>HTTP</th><th>예시</th><th>설명</th></tr></thead>
            <tbody>
              <tr><td>200/201</td><td><code>{"transactionHash":"0x..."}</code></td><td>성공</td></tr>
              <tr><td>400</td><td><code>{"error":"missing field: assetId"}</code></td><td>요청 오류</td></tr>
              <tr><td>401</td><td><code>{"error":"invalid api key"}</code></td><td>인증 실패</td></tr>
              <tr><td>403</td><td><code>{"error":"no view right"}</code></td><td>권한 없음</td></tr>
              <tr><td>409</td><td><code>{"error":"title exists"}</code></td><td>중복/상태 충돌</td></tr>
              <tr><td>500</td><td><code>{"error":"internal error"}</code></td><td>서버 오류</td></tr>
            </tbody>
          </table>
          <div class="tip small" style="margin-top:8px">트랜잭션성 API는 응답 내 <code>transactionHash</code>가 포함됩니다.</div>
        </article>
        <article class="card">
          <h3>보안 모범 사례</h3>
          <ul class="small">
            <li><strong>IP Allowlist</strong>: API 키는 허용 IP만 사용</li>
            <li><strong>최소 권한</strong>: 운영/개발/테스트 키 분리</li>
            <li><strong>키 로테이션</strong>: 분기별 교체, 유출 시 즉시 폐기</li>
            <li><strong>민감 데이터</strong>: docHash는 이벤트 미노출, 권한자만 조회</li>
          </ul>
          <div class="note info">운영체제/네트워크 로그에 요청 본문(특히 주소·해시)을 과다 저장하지 마세요.</div>
        </article>
      </div>
    </section>

    <!-- ===== 복붙용 안내문 ===== -->
    <section class="section">
      <div class="container">
        <h2 class="section-title">협력사 안내문</h2>
        <div class="card">
          <p>
            “국민은행 과제에서 요구하는 실물자산(RWA) 담보 흐름을, 온체인 스마트 컨트랙트 기반 <strong>HTTP API</strong>로 제공합니다.
            매니저 설정 → 담보 생성(타이틀/뷰어 동시 발행) → 메타데이터/권리 표기 → 필요 시 열람권 소각까지
            은행 시스템에서 지갑 없이 호출할 수 있도록 설계했습니다. 민감 데이터(docHash)는 권한자만 확인 가능하며,
            모든 상태 변경은 이벤트로 감사 추적이 가능합니다.”
          </p>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container foot" style="display:flex;justify-content:space-between;align-items:center;gap:16px">
      <div>© Mustree Network</div>
      <nav>
        <a href="./resources.html">문서</a>
        <a href="./resources.html#security">보안 정책</a>
        <a href="./customers.html#contact">문의</a>
      </nav>
    </div>
  </footer>

  <script>
    // ===== 공통 ====
    const $ = s => document.querySelector(s);
    const fmt = (v) => typeof v === 'string' ? v : JSON.stringify(v, null, 2);
    const getBase = () => ($('#baseUrl').value || 'http://localhost:8080/api/v1').replace(/\/$/,'');
    const getHdrs = (json=true) => {
      const h = { 'x-api-key': $('#apiKey').value || '' };
      if (json) h['content-type'] = 'application/json';
      return h;
    };
    const print = (obj, id='out') => { $( '#'+id ).textContent = fmt(obj); };

    // ===== cURL 복사 =====
    function copyCurl(kind){
      const BASE = getBase(), KEY = $('#apiKey').value || '$API_KEY';
      let curl = '';
      if(kind==='setManager'){
        const m = $('#inManager').value || '0xManager...';
        curl = `curl -X POST "${BASE}/contract/set-manager" -H "x-api-key: ${KEY}" -H "content-type: application/json" -d '{"manager":"${m}"}'`;
      } else if(kind==='createAsset'){
        curl = `curl -X POST "${BASE}/assets" -H "x-api-key: ${KEY}" -H "content-type: application/json" -d '{"assetId":"1","viewerId":"1001","bank":"0xBank...","appraiser":"0xAppraiser...","borrower":"0xBorrower...","docHash":"ipfs://bafy..."}'`;
      } else if(kind==='tokenURI'){
        curl = `curl "${BASE}/tokens/1/uri" -H "x-api-key: ${KEY}"`;
      } else if(kind==='burnViewer'){
        curl = `curl -X POST "${BASE}/assets/1/viewer/burn" -H "x-api-key: ${KEY}"`;
      }
      navigator.clipboard.writeText(curl).then(()=>alert('cURL 복사 완료'));
    }

    // ===== Try It ====
    async function ping(){
      try{
        const r = await fetch(`${getBase()}/health`, { headers:getHdrs(false) });
        print(await r.json());
      }catch(e){ print({ error: e.message || e }); }
    }

    async function apiSetManager(){
      const body = { manager: $('#inManager').value || '0xManager...' };
      try{
        const r = await fetch(`${getBase()}/contract/set-manager`, { method:'POST', headers:getHdrs(), body: JSON.stringify(body) });
        print(await r.json());
      }catch(e){ print({ error: e.message || e }); }
    }

    async function apiCreateAsset(){
      let body;
      try{ body = JSON.parse($('#inCreateAsset').value || '{}'); }
      catch{ return print({ error:'JSON Body 를 확인하세요' }); }
      try{
        const r = await fetch(`${getBase()}/assets`, { method:'POST', headers:getHdrs(), body: JSON.stringify(body) });
        print(await r.json());
      }catch(e){ print({ error: e.message || e }); }
    }

    // tokenURI → JSON 디코드
    function decodeTokenURI(dataURI){
      try{
        const i = dataURI.indexOf('base64,');
        if(i<0) return { error:'base64 접두어가 없습니다' };
        const b64 = dataURI.slice(i+7);
        const jsonStr = atob(b64);
        return JSON.parse(jsonStr);
      }catch(e){ return { error:'디코드 실패', detail: String(e) }; }
    }

    async function apiGetTokenURI(){
      const tokenId = $('#decodeTokenId')?.value || $('#inTokenId')?.value || '1';
      try{
        const r = await fetch(`${getBase()}/tokens/${tokenId}/uri`, { headers:getHdrs(false) });
        const data = await r.json();
        print(data);
        const decoded = decodeTokenURI(data?.tokenURI || '');
        if ($('#decodeOut')) { $('#decodeOut').textContent = fmt(decoded); }
      }catch(e){
        print({ error: e.message || e });
        if ($('#decodeOut')) $('#decodeOut').textContent = '';
      }
    }

    async function apiBurnViewer(){
      const assetId = $('#burnAssetId')?.value || $('#inBurnAssetId')?.value || '1';
      try{
        const r = await fetch(`${getBase()}/assets/${assetId}/viewer/burn`, { method:'POST', headers:getHdrs() });
        print(await r.json());
      }catch(e){ print({ error: e.message || e }); }
    }
  </script>
</body>
</html>
